(async()=>{const p=window.location.pathname.split("/")[2],o=document.getElementById("addsub_form"),d={youtube:{holderId:"#ytsublist",platform:"youtube",title:"Youtube Subscription",description:"Automatically notify people when someone posts a YouTube video"},twitch:{holderId:"#twsublist",platform:"twitch",title:"Twitch Subscription",description:"Automatically notify people when someone goes live on Twitch"},twitter:{holderId:"#twitsublist",platform:"twitter",title:"Twitter Subscription",description:"Automatically notify people when someone tweets"},instagram:{holderId:"#igsublist",platform:"instagram",title:"Instagram Subscription",description:"Automatically notify people when someone posts on Instagram"},reddit:{holderId:"#rdtsublist",platform:"reddit",title:"Reddit Subscription",description:"Automatically notify people when someone posts on Reddit"}};let u;await window.DiscordAPIHandler.getChannels(p,{channelType:"GuildText"}).then(t=>{(u=t).forEach(t=>{$("#channelselect").append(new Option(t.name,t.id))})}).catch(t=>{window.NotificationHandler.show({title:"Error",content:t.message,type:"error"})}),Object.entries(d).forEach(async([t,e])=>{var a,n;[a,{holderId:n,title:t,description:e}]=[t,e],await $("#main_body").append(function(t,e,a,n){var i=`<div class="d-flex justify-content-center p-5">
        <div class="spinner-border" role="status">
          <span class="visually-hidden">${i18next.t("dashboard.loading")}</span>
        </div>
      </div>`,t=$("<div>",{class:"card my-3"}).append($("<div>",{class:"card-header"}).append($("<div>",{class:"d-flex align-items-center justify-content-between"}).append($("<div>").append($("<h4>",{class:"card-title"}).html(`<i class="ti ti-brand-${t} text-red"></i> `+e),$("<h6>",{class:"card-subtitle text-muted"}).text(a)),$("<div>",{class:"list-unstyled d-flex align-items-center justify-content-center justify-content-lg-start gap-3"}).append($("<button>",{class:"btn btn-primary mb-4","data-bs-toggle":"modal","data-bs-target":"#AddSubModal"}).html('<i class="ti ti-square-rounded-plus-filled"></i> Add')))),$("<div>",{class:"card-body"}).append($("<div>",{class:"row"}).append($("<div>",{class:"col"}).append($("<div>",{class:"list-group",id:n.replace("#","")}).append(i)))));return t}(a,t,e,n)),await $.get(`/dashboard/${p}/autoalert/${a}/list`,function(t){var e=$(n).empty(),t=t.data;t?.length?t.forEach(t=>s(a,t,n)):e.append(window.ContentHandler.createAlert("No subscriptions found for this platform"))}).fail(function(t){window.console.error(t),window.NotificationHandler.show({title:"Error fetching data",content:t.responseJSON.error,type:"error"})})});const n=document.getElementById("editsub_modal");n.addEventListener("show.bs.modal",t=>{t=t.relatedTarget;t.classList.add("active","modalactive");const e=$(n).find(".modal-body");var a=$(n).find(".modal-footer");if("#editsub_modal"===t.getAttribute("data-bs-target")){const i=t.getAttribute("data-bs-platform");t=t.getAttribute("data-bs-id");t!=e.find("#ytid").val()&&($.ajax({url:`/dashboard/${p}/autoalert/${i}/update/`+t,method:"GET",contentType:"application/json",success:function(t){t.data.forEach(t=>{const e=t["Youtube"];var a=e["message"],n=a["embed"],a=($("#update_ytid").val(e.youtubeId),$("#update_ytmsgtoggle").prop("checked",a.msg.toggle),$("#update_ytmsg").val(a.msg.content),$("#update_edittoggle").prop("checked",n.toggle),$("#update_editsection").toggleClass("d-none",!n.toggle),$("#update_titleem").val(n.title),$("#update_titleurlem").val(n.titleurl),$("#update_desem").val(n.description),$("#update_authorname").val(n.authorname),$("#update_authoricon").val(n.authoricon),$("#thumbem").val(n.thumbnail),$("#imageem").val(n.image),$("#update_ftem").val(n.footer),$("#update_footericon").val(n.footericon),$("#update_tsem").prop("checked",n.timestamp),$("#form").attr("action",`/dashboard/${t.guildId}/autoalert/${i}/update/`+e.youtubeId),$("#update_edittoggle").on("change",function(){$("#update_editsection").toggleClass("d-none")}),u.map(t=>({id:t.id,text:t.name,value:t.id})));$("#ch_update").empty(),a.forEach(t=>{$("#ch_update").append(new Option(t.text,t.value,!1,e.channelId===t.id))})})},error:function(t){e.html(window.ContentHandler.createAlert(t.responseJSON.error))}}),a.html(`
            <button type="button" class="btn btn-dark" data-bs-dismiss="modal">${i18next.t("dashboard.cancel")}</button>
            <button type="submit" class="btn btn-danger" name="ytdelete">Delete</button>
            <button type="submit" class="btn btn-warning" name="ytupdate">Update</button>
        `))}}),n.addEventListener("hidden.bs.modal",t=>{document.getElementsByClassName("modalactive")[0].classList.remove("active","modalactive")});var i=$(".validation-wizard").show();async function s(t,e,a){if(t&&e&&a){var n=$("<a>",{role:"button","data-bs-toggle":"modal","data-bs-target":"#editsub_modal","data-bs-platform":t}).addClass("list-group-item list-group-item-action"),i=$("<div>").addClass("d-flex gap-2 w-100 justify-content-between mt-1 mb-1"),o=$("<h5>").addClass("mb-0"),d=$("<span>").addClass("badge text-bg-primary"),o=(o.append(d),$("<div>").append(o)),s=$("<small>").addClass("opacity-50 text-nowrap"),r=$("<span>").addClass("badge bg-secondary-subtle text-secondary-emphasis rounded-pill");if(s.append(r),i.append(o,s),n.append(i),"youtube"===t){const{channelId:l,youtubeId:c}=e;o=u.find(t=>t.id===l).name,s=await async function(a,n){if(a&&n)return new Promise((e,t)=>{$.ajax({url:`/dashboard/${p}/autoalert/${a}/fetch/`+n,method:"GET",contentType:"application/json",success:function(t){e(t.data)},error:function(t){window.console.error(t),e(n)}})})}("youtube",c);n.attr("data-bs-id",c),n.attr("id",c),d.text(s?.title||c),r.text(o),$(a).append(n)}}}$(".validation-wizard").steps({headerTag:"h6",bodyTag:"section",transitionEffect:"fade",titleTemplate:'<span class="step">#index#</span> #title#',labels:{finish:"Submit"},onStepChanging:function(t,e,a){return a<e||!(3===a&&Number($("#age-2").val())<18)&&(e<a&&(i.find(".body:eq("+a+") label.error").remove(),i.find(".body:eq("+a+") .error").removeClass("error")),i.validate().settings.ignore=":disabled,:hidden",i.valid())},onFinishing:function(t,e){return i.validate().settings.ignore=":disabled",i.valid()},onFinished:function(t,e){if(o.checkValidity()){o.classList.add("was-validated");var a,n=o.getAttribute("action");const i=n.split("/")[4];n?(a=new FormData(o),a={...Object.fromEntries(a.entries()),add_type:i},$.ajax({url:n,contentType:"application/json",method:"POST",data:JSON.stringify(a),success:function(t){s(i,t.data,d[i])},error:function(t){window.console.error(t),window.NotificationHandler.show({type:"error",content:t.responseJSON.error,title:"Unable to add subscription"})}})):window.NotificationHandler.show({type:"error",content:"Please select a subscription type",title:"Unable to add subscription"})}else t.preventDefault(),t.stopPropagation(),o.classList.remove("was-validated")}}),$(".validation-wizard").validate({ignore:"input[type=hidden]",errorClass:"invalid-feedback",successClass:"text-success",highlight:function(t,e){$(t).removeClass(e)},unhighlight:function(t,e){$(t).removeClass(e)},errorPlacement:function(t,e){t.insertAfter(e)},rules:{email:{email:!0}}}),$("#ytembedtoggle").on("change",function(){$("#emsection").toggleClass("d-none")}),$(".btn-check").on("click",function(){$(".btn-check").not(this).prop("checked",!1),o.setAttribute("action",`/dashboard/${p}/autoalert/${this.name}/add`)})})();