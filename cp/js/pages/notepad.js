(async()=>{const a={list:"/notepad/list",get:"/notepad/fetch",add:"/notepad/add",edit:"/notepad/edit",delete:"/notepad/delete"},s=$("#editnotesmodal");var e=s.find(".modal-header");const t=s.find(".modal-dialog"),n=s.find(".modal-content"),o=$("#editnote_maximize i");var i=$("#note_metadata");const r=$("#edit_title"),d=$("#edit_description"),c={placeholder:!0,delimiter:";",paste:!0,searchEnabled:!0,searchChoices:!0,editItems:!0,maxItemCount:10,removeItemButton:!0,addItems:!0,loadingText:i18next.t("dashboard.loading"),noResultsText:i18next.t("dashboard.no_search_result"),noChoicesText:i18next.t("dashboard.choices.noChoicesText"),itemSelectText:i18next.t("dashboard.choices.itemSelectText"),uniqueItemText:i18next.t("dashboard.choices.uniqueItemText"),customAddItemText:i18next.t("dashboard.choices.customAddItemText")};let l={top:0,left:0},u={width:0,height:0};function p(){o.hasClass("ti-maximize")?(l={top:t.css("top"),left:t.css("left")},u={width:n.css("width"),height:n.css("height")},t.css({top:0,left:0}),n.animate({width:"100%",height:"100%"}),t.draggable({disabled:!0})):(t.animate(l),n.animate(u),t.draggable({handle:".modal-header",disabled:!1})),t.toggleClass("modal-fullscreen"),o.toggleClass("ti-maximize ti-minimize")}t.draggable({handle:".modal-header"}),n.resizable({minHeight:300,minWidth:300}),i.resizable({maxWidth:600,handles:"e, w"}),$("#editnote_maximize").on("click",p),e.on("dblclick",p);const g=$("#addnotesmodal"),m=io(),f=(m.on("connect",()=>{logger.debug("Connected to server")}),m.on("current-notepad",function(e){console.log(e),async function(e){e=await h(e.content);f.render(e)}(e)}),new EditorJS({...window.CustomEditorJS_Config,holder:"editorjs",onReady:async function(){logger.debug("Editor.js is ready to work!");try{new window.Undo({editor:f}),new window.DragDrop(f)}catch(e){logger.error("Editor.js is not ready to work!",e)}},onChange:async function(e,t){f.save().then(e=>{var t;e=e,(t=y())&&(m.emit("save-notepad",{id:t,content:e}),t=w(e.blocks),currentWordsCount.innerHTML=DOMPurify.sanitize(t))}).catch(e=>{console.error("Saving error",e)})}}));async function h(e){return e=JSON.parse(decodeURI(e))}function v(e){return"text"in e.data}function w(e){return e.filter(v).reduce((e,t)=>e+=t.data.text.length,0)}function y(){return document.getElementById("note-id").innerText}function b(e){document.getElementById("note-id").innerText=e}let x=null,k=null;function T(e){e&&(e.setValue([]),e.clearStore(),e.clearInput())}function C(e){return $.ajax({url:a.get+"/"+e,type:"GET",contentType:"application/json"})}function j(e){return new Date(e).toLocaleDateString("en-US",{day:"2-digit",month:"short",year:"numeric"})}function E({title:e,description:t,id:n,modifiedAt:o,tags:i}){n=`
        <div class="col-md-4 single-note-item all-category view-note" id="${n}">
          <div class="card card-body card-hover cursor-pointer">
            <span class="side-stick"></span>
            <div class="d-flex align-items-start justify-content-between">
              <div class="position-relative">
                <h6 class="note-title text-truncate w-75 mb-0" data-noteHeading="${e}">
                  ${e}
                </h6>
                <p class="note-date fs-2">${j(o)}</p>
              </div>
              <div class="position-relative note-tags">
                ${S(i)}
              </div>
            </div>
            <div class="note-content">
              <p class="note-inner-content" data-noteContent="${t}">
                ${t}
              </p>
            </div>
            <div class="d-flex align-items-center">
              <a href="javascript:void(0)" class="link fs-4 me-1 favourite-note"><i class="ti ti-star"></i></a>
              <a href="javascript:void(0)" class="link fs-4 text-danger ms-2 me-1 remove-note"><i class="ti ti-trash"></i></a>
              <a href="javascript:void(0)" class="link fs-4 text-info ms-2 share-note"><i class="ti ti-share"></i></a>
              <div class="ms-auto">
                <div class="category-selector btn-group">
                  <a class="nav-link category-dropdown label-group p-0" data-bs-toggle="dropdown" href="#" role="button" aria-haspopup="true" aria-expanded="true">
                    <div class="category">
                      <div class="category-business"></div>
                      <div class="category-social"></div>
                      <div class="category-important"></div>
                      <span class="more-options text-dark"><i class="ti ti-dots-vertical fs-5"></i></span>
                    </div>
                  </a>
                  <div class="dropdown-menu dropdown-menu-right category-menu dropdown-menu-animate-up">
                    <a class="note-business badge-group-item badge-business dropdown-item position-relative category-business" href="javascript:void(0);">Business</a>
                    <a class="note-social badge-group-item badge-social dropdown-item position-relative category-social" href="javascript:void(0);"> Social</a>
                    <a class="note-important badge-group-item badge-important dropdown-item position-relative category-important" href="javascript:void(0);"> Important</a>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>`;$("#note-full-container").prepend(n),function t(){$(".view-note").off("click").on("click",async function(e){e.stopPropagation(),$(".view-note").off("click");const o=$(this).attr("id"),i=(window.urlHandler.setQuery("id",o),s.modal("show"),()=>{f.blocks.insert("paragraph",{text:"Welcome to Notepad! This is a sample text. You can edit this text by clicking on it and start typing. You can also add more blocks by clicking the plus icon on the left side of the editor."})});f.isReady.then(()=>{o===y()?N(!0):(T(k),C(o).done(async function(e){try{await f.clear(),b(o),r.val(e.data.title),d.val(e.data.description),k.setValue(e.data.tags);const t=await h(e.data.content)||{},n=(f.render(t),w(t.blocks)||0);currentWordsCount.innerText=n}catch(e){logger.error(e),i()}N(!0)}).fail(function(e){logger.error(e),window.NotificationHandler.show({content:"Error fetching note",type:"error"})})),t()}).catch(e=>{logger.error("Editor.js initialization failed because of "+e)})})}(),$(".remove-note").off("click").on("click",function(e){e.stopPropagation();const t=$(this).parents(".single-note-item").attr("id");$.ajax({url:a.delete,type:"POST",contentType:"application/json",data:JSON.stringify({id:t}),success:function(){$("#"+t).remove(),window.NotificationHandler.show({content:"Note deleted successfully",type:"success"}),H()},error:function(){window.NotificationHandler.show({content:"Error deleting note",type:"error"})}})}),$(".share-note").off("click").on("click",function(e){e.stopPropagation();e=$(this).parents(".single-note-item").attr("id");window.ContentHandler.Share(window.location.origin+window.location.pathname+"?id="+e)}),$(".favourite-note").off("click").on("click",function(e){e.stopPropagation(),$(this).parents(".single-note-item").toggleClass("note-favourite")}),$(".category-selector .badge-group-item").off("click").on("click",function(e){e.preventDefault();var e=$(this).parents(".single-note-item"),t=this.className.split(" ")[0];e.removeClass(["note-business","note-social","note-important"].join(" ")).toggleClass(t)}),T(x)}function S(e){let n="";return e.forEach((e,t)=>{3<t||(n+=`<span class="badge text-bg-primary rounded-3 fs-2 fw-semibold me-1">${e}</span>`)}),DOMPurify.sanitize(n)}function N(e){$("#editorjs_loading").toggle(!e),$("#editorjs").toggle(e)}function I(e){e=document.querySelector("#"+e);return e?new Choices(e,{...c,placeholderValue:e.getAttribute("placeholder"),classNames:{item:"badge rounded-pill choices-"+e.dataset.color+" me-2 mb-2"}}):null}function H(){var e=$(".single-note-item"),t=$("#noNoteFound");0===e.length?t.removeClass("d-none"):t.addClass("d-none")}$(".note-link").on("click",function(e){var t=$("."+this.id).fadeIn();$("#note-full-container > div").not(t).hide(),$(".note-link").removeClass("active"),$(this).addClass("active")}),$("#note-has-title").on("keyup",function(){$("#btn-n-add").prop("disabled",""===$(this).val())}),$("#btn-n-add").on("click",function(e){e.preventDefault();var e=document.getElementById("addsub_form"),t=Object.fromEntries(new FormData(e).entries());$.ajax({url:e.getAttribute("action"),type:"POST",contentType:"application/json",data:JSON.stringify(t),success:function(e){E(e.data),g.modal("hide"),H()},error:function(){window.NotificationHandler.show({content:"Error adding note",type:"error"})}})}),g.on("hidden.bs.modal",function(){$("#note-has-title, #note-has-description").val(""),$("#btn-n-add").prop("disabled",!0)}),s.on("hidden.bs.modal",function(){N(!1),window.urlHandler.removeQuery("id")}),$("#add-notes").on("click",function(){g.modal("show"),$("#btn-n-save").hide(),$("#btn-n-add").show()}),$("#save_edited_note").on("click",function(){const n=y();var e;n&&(e=document.getElementById("editnote_form"),(e=Object.fromEntries(new FormData(e).entries())).id=n,$.ajax({url:a.edit,type:"POST",contentType:"application/json",data:JSON.stringify(e),success:function(e){window.NotificationHandler.show({content:"Note updated successfully",type:"success"});var t=document.getElementById(n),e=e.data.notepads.find(e=>e.id===n);t.querySelector(".note-title").innerText=e.title,t.querySelector(".note-inner-content").innerText=e.description,t.querySelector(".note-date").innerText=j(e.modifiedAt),t.querySelector(".note-tags").innerHTML=S(e.tags)},error:function(e){logger.error(e),window.NotificationHandler.show({content:"Error updating note",type:"error"})}}))}),window.addEventListener("DOMContentLoaded",()=>{window.ContentHandler.DisableContextMenu(".modal-header"),$.ajax({url:a.list,type:"GET",contentType:"application/json",success:async function(e){var e=e.data||{},e=(e?.length&&await e.forEach(E),$("#notefull").remove(),$("#note-full-container").removeClass("d-none"),window.urlHandler.getQuery("id"));e&&((e=document.getElementById(e))?e.click():window.NotificationHandler.show({content:"Note not found",type:"error"})),H()},error:function(){window.NotificationHandler.show({content:"Error fetching notes",type:"error"})}}),x=I("choices-tags"),k=I("edit_tags")})})();