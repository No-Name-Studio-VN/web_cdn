function compelsubject(t,e,n){return 1==t?'<i class="ti ti-check text-danger"></i>':'<i class="ti ti-x text-success"></i>'}function parseUETDocs(t,e,n){return`<div class='d-flex align-items-center gap-3'>
        <button type="button" disabled id="${Math.random().toString(36).substring(7)}" class='btn btn-primary'><i class="ti ti-eye"></i></button>
        <button nns-external-window nns-external-url="${t}" class='btn btn-primary'><i class="ti ti-download"></i></button>
    </div>`}(()=>{"true"==localStorage.getItem("utkused")&&localStorage.removeItem("utkused");var t=C("utkused");(!t||"number"!=typeof t||t<2)&&(k(),_(),T("utkused",2),window.location.reload());const d={permissions:{"detail-user":"Xem thông tin người dùng","detail-program":"Xem thông tin chương trình đào tạo","view-learning-time":"Xem thời gian học tập","detail-learning-time":"Xem chi tiết thời gian học tập","view-academic-consult":"Xem tư vấn học vụ","detail-academic-consult":"Xem chi tiết tư vấn học vụ","view-graduate":"Xem khả năng tốt nghiệp","detail-graduate":"Xem chi tiết khả năng tốt nghiệp","detail-prmotion":"Xem chi tiết khen thưởng kỷ luật"},letterGradeMapping:[{limit:4,letter:"F",score:0},{limit:5,letter:"D",score:1},{limit:5.5,letter:"D+",score:1.5},{limit:6.5,letter:"C",score:2},{limit:7,letter:"C+",score:2.5},{limit:8,letter:"B",score:3},{limit:8.5,letter:"B+",score:3.5},{limit:9,letter:"A",score:3.7},{limit:11,letter:"A+",score:4}],gpaWarnings:[{limit:2,class:"text-danger",icon:"ti ti-alert-triangle",text:"Quả GPA này căng đấy, cẩn thận nhé."},{limit:2.5,class:"text-warning",icon:"ti ti-alert-triangle",text:"GPA của bạn không cao, hãy cố gắng hơn nữa."},{limit:3.2,class:"text-info",icon:"ti ti-alert-triangle",text:"GPA của bạn ở mức trung bình, hãy cố gắng hơn nữa."},{limit:1/0,class:"text-success",icon:"ti ti-check",text:"Bạn đang học tốt. Hãy tiếp tục giữ vững thành tích của mình."}],scoreChartLabel:["A+","A","B","B+","C","C+","D","D+","F"],colorData:["#008000","#598e00","#919900","#c8a100","#ffa500","#ff8b00","#ff6f00","#ff4c00","#ff0000"],API:{home:"https://daotao.uet.vnu.edu.vn",resetPassword:"https://idp.vnu.edu.vn/auth/realms/vnu/login-actions/reset-credentials",signIn:"https://daotao.uet.vnu.edu.vn/api/login",signOut:"https://daotao.uet.vnu.edu.vn/api/logout",getClasses:"/api/uettoolkit/qldt?{query}",getDsThi:"/api/uettoolkit/dsthi?{query}",getScore:"https://daotao.uet.vnu.edu.vn/api/graduates/{id}",getPromotion:"https://daotao.uet.vnu.edu.vn/api/prmotions/{id}",getLearningTime:"https://daotao.uet.vnu.edu.vn/api/learningtimes/_term/?limit=100",getStudentOverview:"https://daotao.uet.vnu.edu.vn/api/students/{id}/_warnings",getUser:"https://daotao.uet.vnu.edu.vn/api/user/info",getProgram:"https://daotao.uet.vnu.edu.vn/api/programs/{id}",getAcademicConsult:"https://daotao.uet.vnu.edu.vn/api/academicconsultings/",getTermList:"/api/uettoolkit/termlist",getTKB:"/api/uettoolkit/tkb"},TokenValidTime:6048e5,tkbTemplate:{mamh:"Mã môn",mh:"Học phần",stc:"Số tín",ml:"Mã lớp học",gv:"Giáo viên",b:"Số buổi",thu:"Thứ",tiet:"Tiết",gd:"Giảng đường",gc:"Ghi chú"}},o=/@vnu\.edu\.vn$/,n=document.getElementById("loginrequire"),a=document.getElementById("loginrequire_msg"),i=document.getElementById("signinvnu");t=document.getElementById("forgetpassword");const r=document.getElementById("signinform"),e=document.getElementById("logintrigger"),s=document.getElementById("vnuemail");var c=document.getElementById("vnupassword");const l=document.getElementById("forcereloaddata"),u=document.getElementById("gpachart_overview"),h=document.getElementById("uet_info_card"),g=document.getElementById("uet_permissions_card"),m=document.getElementById("uet_graduate_check_card"),p=$("#tkb-table"),b=$("#showLearning");function v(t){t=t?"show":"hide";$("#maindashboard")[t](),$("#mainTab")[t](),$("#mainTabContent")[t]()}function f(){i.innerHTML="Đăng nhập",i.hasAttribute("disabled")&&i.removeAttribute("disabled")}function w(t,e){a.innerText=t,"success"==e?(n.classList.add("alert-success","show"),n.classList.contains("alert-danger")&&n.classList.remove("alert-danger")):"error"==e&&(n.classList.add("alert-danger","show"),n.classList.contains("alert-success"))&&n.classList.remove("alert-success")}function y(){l.style.display=null,e.innerHTML="Đăng xuất",e.addEventListener("click",()=>{new Promise((e,n)=>{var t=C("vnutoken");t||n(new Error("Bạn chưa đăng nhập vào tài khoản VNU.")),$.ajax({url:d.API.signOut,contentType:"application/json",method:"POST",headers:{Authorization:"Bearer "+t.token},success:function(t){"OK"==t.status&&e()},error:function(t){n(t)}})}).then(()=>{NotificationHandler.show({type:"success",content:"Đăng xuất thành công.",title:"Thành công"})}).catch(t=>{P(t,"signout")}),k(),_(),window.location.reload()}),e.classList.add("btn-danger"),e.classList.remove("btn-primary"),["data-bs-toggle","data-bs-target"].forEach(t=>{e.hasAttribute(t)&&e.removeAttribute(t)})}function k(){x("vnutoken")}function _(){["uetuser","uetprogram","uetstudentoverview","uetlearningtime","uetpromotion","uetscore","uetclasses","uetdsthi","uettermlist","uetacademicconsult","uettkb"].forEach(t=>{x(t),x(t+"expire")})}function T(t,e){e=JSON.stringify(e),localStorage.setItem(t,(t=e,t=Base64.encode(t),CryptoJS.AES.encrypt(t,"sieudangyeu").toString()))}function C(t){var e,t=localStorage.getItem(t);return t?JSON.parse((e=t,e=CryptoJS.AES.decrypt(t,"sieudangyeu").toString(CryptoJS.enc.Utf8),Base64.decode(e))):null}function x(t){localStorage.removeItem(t)}function E(i,r,s=!1){return new Promise(async(e,t)=>{var n=await C("vnutoken"),a=(n||e(null),await C(i)),o=await C(i+"expire");s&&await x(i),a&&Math.abs(o-Date.now())<d.TokenValidTime?e(a):(x(i),$.ajax({url:r,method:"GET",contentType:"application/json",headers:{Authorization:"Bearer "+n.token},success:function(t){"OK"==t.status&&t.results?(T(i,t.results),T(i+"expire",Date.now()+d.TokenValidTime),e(t.results)):e(null)},error:function(t){P(t,"signin")}}))})}function H(t,e=!1){return E("uetclasses",d.API.getClasses.replace("{query}",t),e)}function I(t,e){return{SinhvienLmh:{masvTitle:t,term_id:e}}}function S(e){var t;e.append('<option value="0" selected disabled>Lựa chọn học kì</option>'),t=!1,E("uettermlist",d.API.getTermList,t).then(t=>{t.forEach(t=>{e.append(new Option(t.text,t.value))})})}function B(t,e,n){var a=document.createElement("div");a.className="mb-2",a.innerHTML=`<i class="icon ${n} me-2 text-secondary"></i>${t}: <strong>${e}</strong>`,h.appendChild(a)}function L(){return new Promise((i,t)=>{var e;e=!1,E("uetuser",d.API.getUser,e).then(async t=>{var e,n,a,o;t?(a=t.addition_info.prg1,o=!1,a=await E("uetprogram",d.API.getProgram.replace("{id}",a),o),o=t.username,n=!1,o=await E("uetstudentoverview",d.API.getStudentOverview.replace("{id}",o),n),n=t.username,e=!1,n=await E("uetscore",d.API.getScore.replace("{id}",n),e),i({...t,program:a,score:n,student_overview:o})):i(null)})})}function M(){L().then(async r=>{if(!r)return w(n="Không thể lấy thông tin người dùng. Vui lòng thử lại sau.","error"),NotificationHandler.show({type:"error",content:n});var t,e,n=r.student_overview.student_avg,a=(i=(c=r).name??"Người dùng",o=c.avatar??client.cdn+"/media/image/logouet.png",t=c.student_overview,s=t.student_year,e=t.term_name,t=t.student_avg,$("#uet_banner_avt").attr("src",o).attr("alt",i),$("#uet_banner_hi").text("Xin chào, "+i),$("#uet_banner_desc").text(`Sinh viên năm ${s} khoa `+c.program.name),$("#uet_banner_term_name").text(e),$("#uet_banner_student_avg").text(t),$("#uet_banner_estimate_graduate_type").text(function(t){return 3.6<=t?"Xuất sắc":3.2<=t?"Giỏi":2.5<=t?"Khá":2<=t?"Trung bình":"Yếu"}(t)),ContentHandler.toggleMainContent("#uet_banner",!0),n);for(const l of d.gpaWarnings)if(a<l.limit){$("#uet_warning_icon").addClass(l.class+" "+l.icon),$("#uet_warning_text").text(l.text);break}ContentHandler.toggleMainContent("#uet_warning",!0);var o=r,i=(o=A(r.score).scoreData,window.ApexCharts&&new ApexCharts(u,{series:o,chart:{type:"pie",fontFamily:"inherit",height:240,sparkline:{enabled:!0},animations:{enabled:!0}},fill:{opacity:1},labels:d.scoreChartLabel,grid:{strokeDashArray:4},colors:d.colorData,legend:{show:!0,position:"bottom",offsetY:12,markers:{width:10,height:10,radius:100},labels:{colors:"var(--bs-heading-color)",useSeriesColors:!1},itemMargin:{horizontal:8,vertical:8}},tooltip:{fillSeriesColor:!1},dataLabels:{enabled:!0,enabledOnSeries:void 0,formatter:function(t,e){return t.toFixed(1)+"%"}}}).render(),ContentHandler.toggleMainContent("#uet_chart_gpa",!0),r),s=(i=A(i.score).score,$("#grade-table").bootstrapTable({...window.CustomBT_Config,cookieIdTable:"uet_grade_table",toolbar:"#grade-toolbar",data:i.details}),$("#grade-table").bootstrapTable("refreshOptions",{exportOptions:{fileName:"Bảng điểm sinh viên"}}),ContentHandler.toggleMainContent("#uet_accordion_score",!0),r),c=((s=s.program.credits).forEach((t,e)=>{t.count=e+1}),$("#programs-table").bootstrapTable({...window.CustomBT_Config,cookieIdTable:"uet_programs_table",toolbar:"#programs-toolbar",data:s}),$("#programs-table").bootstrapTable("refreshOptions",{exportOptions:{fileName:"Khung chương trình đào tạo"}}),ContentHandler.toggleMainContent("#uet_accordion_programs",!0),$("#panelsStayOpen-qldt").one("show.bs.collapse",function(){!async function(e){var t=$("#select_term_id"),n=(await S(t),$("#select_term_id").off("change").on("change",async function(){var t=$(this).val();ContentHandler.toggleMainContent("#uet_accordion_qldt",!1),0!=t&&(t=await I(e.username,t),(t=await H($.param(t),!0)).forEach((t,e)=>{t.count=e+1}),$("#qldt-table").bootstrapTable("load",t),ContentHandler.toggleMainContent("#uet_accordion_qldt",!0))}),await H($.param(I(e.username,e.score.term_id))));t.val(e.score.term_id),n.shift(),n.forEach((t,e)=>{t.count=e+1}),$("#qldt-table").bootstrapTable({cookie:!0,exportTypes:["json","xml","csv","txt","sql","excel","pdf"],minimumCountColumns:2,pageList:"[10, 25, 50, 100, all]",pagination:!0,search:!0,showColumns:!0,showColumnsToggleAll:!0,showExport:!0,showFullscreen:!1,showMultiSort:!0,showPaginationSwitch:!0,showSearchClearButton:!0,showToggle:!0,toolbar:"#qldt-toolbar",data:n}),$("#qldt-table").bootstrapTable("refreshOptions",{exportOptions:{fileName:"DANH SÁCH LỚP MÔN HỌC"}}),ContentHandler.toggleMainContent("#uet_accordion_qldt",!0)}(r).then(()=>{b.prop("disabled",!1)})}),$("#person-tab").one("show.bs.tab",function(){e=(t=r).username,i=t.name??"Người dùng",n=t.score,a=t.student_overview,o=a.student_year,a=a.term_name,B("Tên",i,"ti ti-user"),B("Ngày sinh",n.std_dob,"ti ti-calendar"),B("Nơi sinh",n.std_pob,"ti ti-map"),B("Email",t.email,"ti ti-at"),B("Mã số sinh viên",e,"ti ti-id-badge"),B("Năm học",o,"ti ti-calendar"),B("Khoa",t.program.name,"ti ti-book"),B("Học kỳ",a,"ti ti-bookmark"),B("Đăng nhập lần cuối",bt_dateformatter(moment(t.last_login)),"ti ti-clock-hour-4"),ContentHandler.toggleMainContent("#uet_info_card",!0),r.permissions.forEach(t=>{var e;t=t,t=d.permissions[t]||t,(e=document.createElement("div")).className="mb-2",e.innerHTML=`<i class="icon ti ti-check me-2 text-success"></i><strong>${t}</strong>`,g.appendChild(e)}),ContentHandler.toggleMainContent("#uet_permissions_card",!0);var t,e,n,a,o,i=r;i=i.score,$("#graduate_alert").text(i.note1),i.notes.forEach((t,e)=>{var n;t=t,(n=document.createElement("div")).className="mb-2",n.innerHTML=`<i class="icon ti ti-pencil me-2 text-secondary"></i><strong>${t}</strong>`,m.appendChild(n)}),ContentHandler.toggleMainContent("#uet_graduate_check_card",!0)}),$("#resource-tab").one("show.bs.tab",function(){new Promise(async(t,e)=>{n=!1;var n=(await E("uetacademicconsult",d.API.getAcademicConsult,n)).data;n.forEach((t,e)=>{t.count=e+1,t.file_path=t.file_path?d.API.home+t.file_path:t.external_link}),$("#resources-table").bootstrapTable({...window.CustomBT_Config,cookieIdTable:"uet_resources_table",toolbar:"#resources-toolbar",data:n}),ContentHandler.toggleMainContent("#uet_resources_card",!0),t()})}),$("#dsthi-tab").one("show.bs.tab",function(){!async function(t){t=await function(t,e=!1){return E("uetdsthi",d.API.getDsThi.replace("{query}",t),e)}($.param({id:t.username}));$("#dsthi-table").bootstrapTable({...window.CustomBT_Config,cookieIdTable:"uet_dsthi_table",toolbar:"#dsthi-toolbar",data:t}),ContentHandler.toggleMainContent("#uet_dsthi_card",!0)}(r)}),$("#tkb-tab").one("show.bs.tab",function(){!async function(){var t=await function(t=!1){return E("uettkb",d.API.getTKB,t)}();function e(){Object.keys(d.tkbTemplate).forEach((t,e)=>{ContentHandler.ToggleMultiSelect(".bootstrap-table-filter-control-"+t,{placeholder:d.tkbTemplate[t]})})}p.bootstrapTable({...window.CustomBT_Config,cookieIdTable:"uet_tkb_table",toolbar:"#tkb-toolbar",data:t}),e();let n=!1;p.on("toggle.bs.table",function(t){(n=!n)&&setTimeout(()=>{e()},500)}),ContentHandler.toggleMainContent("#uet_tkb_card",!0)}().then(()=>{b.on("change",function(){1==$(this).prop("checked")?H().then(t=>{if(!t)return NotificationHandler.show({type:"error",content:"Bạn cần ấn vào mục **Danh sách lớp môn học** và chọn đúng kì học trùng với thời khoá biểu hiện tại để lọc thông tin."}),$(this).prop("disabled",!0),$(this).prop("checked",!1);t=t.map(t=>t.ml);p.bootstrapTable("filterBy",{ml:t})}):p.bootstrapTable("filterBy",{})})})}),$("#mainTab a").on("click",function(t){t.preventDefault(),$(this).tab("show"),localStorage.setItem("UETselectedTab",$(t.currentTarget).attr("href"))}),$("ul.nav-tabs > li > a").on("shown.bs.tab",function(t){t=$(t.target).attr("href").substr(1);window.urlHandler.setHash(t)}),localStorage.getItem("UETselectedTab")??window.urlHandler.getHash());$('#mainTab a[href="'+c+'"]').tab("show")})}function A(t){const o=[0,0,0,0,0,0,0,0,0];return t.details.forEach((t,e)=>{t.count=e+1;var n=t.pnt_official;for(const a of d.letterGradeMapping)if(n<a.limit){t.pnt_letter=a.letter,t.pnt_official4=a.score;break}o[d.scoreChartLabel.indexOf(t.pnt_letter)]++}),{score:t,scoreData:o}}function P(t,e){window.logger.error("UETToolkit",t),"signin"==e?(ContentHandler.ToggleValidation(r.querySelector("input[type='password']"),!1),401==t.status?($("#wrongauth_alert").show(),NotificationHandler.show({type:"error",content:"Đăng nhập thất bại. Vui lòng kiểm tra lại email và mật khẩu.",title:"Lỗi"})):(NotificationHandler.show({type:"error",content:"Đã có lỗi xảy ra khi đăng nhập. Lỗi phổ biến là **CERT-DATE-INVALID**,  xảy ra khi máy chủ của UET không được gia hạn certificate. Truy cập vào [web trường](https://daotao.uet.vnu.edu.vn/) và ấn tiếp tục truy cập để bypass lỗi này.",title:"Lỗi"}),ContentHandler.OpenExternalWindow(d.API.home,"Đăng nhập vào UET")),f()):NotificationHandler.show({type:"error",content:"Đã có lỗi xảy ra khi đăng xuất.",title:"Lỗi"})}window.addEventListener("DOMContentLoaded",()=>{1==function(t){var e=C("vnutoken");{var n;return!!(e&&Math.abs(e?.expire-t)<d.TokenValidTime)||(n=e?"Phiên đăng nhập của bạn đã hết hạn. Vui lòng đăng nhập lại.":"Bạn hiện đang không đăng nhập vào tài khoản VNU. Vui lòng đăng nhập để tiếp tục.",v(!1),w(n,"error"),Math.abs(e?.expire-t)<d.TokenValidTime&&NotificationHandler.show({type:"error",content:n,title:"Hết hạn đăng nhập"}),k(),_(),!1)}}(Date.now())&&(M(),w("Bạn đã đăng nhập vào tài khoản VNU. Bạn có thể tiếp tục sử dụng dịch vụ.","success"),y())}),c.addEventListener("keyup",function(t){"Enter"===t.key&&i.click()}),l.addEventListener("click",function(){_(),window.location.reload()}),t.addEventListener("click",function(){ContentHandler.OpenExternalWindow(d.API.resetPassword,"Quên mật khẩu")}),i.addEventListener("click",function(){ContentHandler.ToggleLoading(i,!0);var t,a,e=document.querySelector("#modal-team input[type='email']").value,n=document.querySelector("#modal-team input[type='password']").value;e&&e.match(o)||ContentHandler.ToggleValidation(r.querySelector("input[type='email']"),!1),n||ContentHandler.ToggleValidation(r.querySelector("input[type='password']"),!1),r.checkValidity()&&e.match(o)?(ContentHandler.ToggleValidation(r.querySelector("input[type='email']"),!0),ContentHandler.ToggleValidation(r.querySelector("input[type='password']"),!0),r.classList.add("was-validated"),i.innerHTML="Đang đăng nhập...",a=n,t=(t=e).trim(),new Promise((e,n)=>{$.ajax({url:d.API.signIn,method:"POST",data:JSON.stringify({email:t,password:a}),contentType:"application/json",success:function(t){"OK"==t.status&&t.results?(t=t.results,e(t)):n(new Error("Đăng nhập thất bại. Vui lòng kiểm tra lại email và mật khẩu."))},error:function(t){n(t)}})}).then(t=>{T("vnutoken",{token:t.token,expire:Date.now()+t.expire_in}),NotificationHandler.show({type:"success",content:"Đăng nhập thành công. Bạn có thể tiếp tục sử dụng dịch vụ.",title:"Thành công"}),$("#modal-team").modal("hide"),M(),w("Bạn đã đăng nhập vào tài khoản VNU. Bạn có thể tiếp tục sử dụng dịch vụ.","success"),y(),v(!0)}).catch(t=>{P(t,"signin")})):(ContentHandler.ToggleLoading(i,!1),f())}),s.addEventListener("keyup",function(t){"@"!=t.key||s.value.match(o)||(s.value+="vnu.edu.vn")});c=[{title:"Dùng UET Toolkit để làm gì?",content:"Ờ mình cũng không biết =)). Chỉ là muốn xem thông tin của trường mình chầm kảm quá. Có cả tí cái web mà mỗi cái lại mỗi kiểu giao diện cái dùng nhìn nó bị rối mắt ấy 🥹. Thay vào đó sao mình không thử gom lại một thể cho nó tiện nhỉ, mỗi lần muốn xem thông tin gì thì vào đăng nhập một cái là xong luôn."},{title:"Dùng cái này có bị hack acc VNU không?",content:`Nếu bạn nghĩ mình code cái này để hack acc các bạn thì hết cứu rồi 🥲. Mình chỉ lưu thông tin trên máy các bạn và gửi lên máy chủ VNU thôi chứ ngoài ra thì mình không gửi thêm gì nữa. Các bạn có thể dùng dev-tool để kiểm tra các request sau khi log acc mình vào để kiếm chứng nhe.
 ![hết cứu](/media/hetcuu.jpg)`},{title:"Các chức năng hiện tại của app này?",content:"Xem điểm(Tự động quy đổi sang điểm chữ), lịch học, lịch thi, thông tin cá nhân, chương trình đào tạo, check khả năng tốt nghiệp, thông tin khen thưởng kỷ luật, tư vấn học vụ. Có thể sẽ có thêm chức năng khác nếu mình có thời gian nghịch thêm."},{title:"Bạn làm web này trường có biết không?",content:"Mình cào chui API của phòng đào tạo đấy, không biết có bị đấm không 🥲🥲🥲🥲"},{title:"Mình có thể xem mã nguồn của web này không?",content:"hông"},{title:"Muốn biết thêm về quá trình code thì sao?",content:"Mình sẽ viết blog về quá trình code web này sau. Mọi người có thể cập nhật [trên đây nhé](https://cp.nnsvn.me/p)"}];document.getElementById("accordionFaq").innerHTML=c.map((t,e)=>`<div class="accordion-item">
            <h2 class="accordion-header" id="heading${e}">
                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapse${e}" aria-expanded="false" aria-controls="collapse${e}">
                    <strong>${t.title}</strong>
                </button>
            </h2>
            <div id="collapse${e}" class="accordion-collapse collapse" aria-labelledby="heading${e}" data-bs-parent="#accordionFaq">
                <div class="accordion-body" nns-markdown>
                    ${t.content}
                </div>
            </div>
        </div>`).join("")})();